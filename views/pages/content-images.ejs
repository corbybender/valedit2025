<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Browser - CMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="/public/css/dashboard.css?v=1" rel="stylesheet" />
    <link href="/public/css/AzureStorage.css" rel="stylesheet" />
    <script src="/public/js/notifications.js"></script>
  </head>
  <body>
    <!-- Notification Container -->
    <div
      id="notificationContainer"
      class="fixed top-4 right-4 z-50 space-y-2"
    ></div>

    <div class="dashboard-container">
      <%- include('../partials/sidebar') %>
      <div class="main-content">
        <%- include('../partials/header') %>
        <main class="content">
          <div class="container mx-auto p-6">
            <!-- Hidden field for website ID needed by JavaScript -->
            <input
              type="hidden"
              id="websiteId"
              value="<%= currentWebsiteID || '' %>"
            />
            <% if (typeof currentWebsiteID !== 'undefined' && currentWebsiteID)
            { %>
            <!-- Debug: Website ID is <%= currentWebsiteID %> -->
            <% } else { %>
            <!-- Debug: Website ID is missing or null -->
            <% } %>

            <h1 class="text-3xl font-bold text-gray-800 mb-8">Image Browser</h1>

            <!-- Library Selection Banner and Upload Button -->
            <div class="mb-6 flex justify-between items-center gap-4">
              <div
                id="library-selection-banner"
                class="bg-blue-50 border-l-4 border-blue-400 p-4 flex-1"
              >
                <div class="flex">
                  <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-400"></i>
                  </div>
                  <div class="ml-3">
                    <p class="text-sm text-blue-700">
                      <strong
                        >Select a library folder below to enable image
                        uploads.</strong
                      >
                      Navigate into a specific folder to upload images to that
                      location.
                    </p>
                  </div>
                </div>
              </div>
              <div class="flex-shrink-0">
                <button
                  id="open-upload-modal-btn"
                  class="bg-gray-400 text-white font-bold py-2 px-4 rounded-lg cursor-not-allowed upload-disabled"
                  data-disabled="true"
                >
                  <i class="fas fa-upload mr-2"></i>Upload Images
                </button>
              </div>
            </div>

            <section class="card">
              <div id="breadcrumb-nav" class="breadcrumb"></div>
              <div class="browser-controls">
                <input
                  type="search"
                  id="search-box"
                  placeholder="Search files and folders..."
                  aria-label="Search current folder"
                />
                <div class="view-controls">
                  <div class="view-toggle">
                    <button
                      id="thumbnail-view-btn"
                      class="view-toggle-btn active"
                      title="Thumbnail View"
                    >
                      <i class="fas fa-th"></i>
                    </button>
                    <button
                      id="list-view-btn"
                      class="view-toggle-btn"
                      title="List View"
                    >
                      <i class="fas fa-list"></i>
                    </button>
                  </div>
                  <button
                    id="create-folder-btn"
                    class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700"
                    title="Create New Folder"
                  >
                    <i class="fas fa-folder-plus mr-2"></i>Create Folder
                  </button>
                </div>
              </div>
              <div id="file-browser-container"></div>
              <div
                class="load-more-container"
                id="load-more-container"
                style="display: none"
              >
                <button id="load-more-btn" class="button">
                  Load More Images
                </button>
              </div>
              <div id="browser-status" class="status-message"></div>
            </section>
          </div>
        </main>
      </div>
    </div>

    <div id="preview-modal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="preview-modal-close">&times;</span>
        <div class="preview-container">
          <div class="preview-image-wrapper">
            <img id="modal-image-preview" src="" alt="Image Preview" />
          </div>
          <div class="preview-details">
            <h3 id="modal-filename"></h3>
            <p>
              <strong>Dimensions:</strong>
              <span id="modal-dimensions">Calculating...</span>
            </p>
            <p><strong>File Size:</strong> <span id="modal-filesize"></span></p>
            <label class="font-semibold mt-4 block">Image URL:</label>
            <div class="url-container">
              <input type="text" id="modal-image-url" readonly />
              <button id="modal-copy-url-btn">
                <i class="fas fa-copy"></i> Copy
              </button>
            </div>
            <div class="modal-actions mt-4">
              <button id="modal-delete-btn" class="delete-btn-modal">
                <i class="fas fa-trash"></i> Delete Image
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="create-folder-modal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="create-folder-modal-close">&times;</span>
        <h3 class="text-xl font-bold mb-4">Create New Folder</h3>
        <form id="create-folder-form">
          <div class="form-group mb-4">
            <label
              for="folder-name-input"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Folder Name:
            </label>
            <input
              type="text"
              id="folder-name-input"
              name="folderName"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              placeholder="Enter folder name"
              required
              maxlength="50"
            />
            <p class="text-sm text-gray-500 mt-1">
              Folder will be created in:
              <strong id="create-folder-path-display"></strong>
            </p>
          </div>
          <div class="flex justify-end space-x-3">
            <button
              type="button"
              id="create-folder-cancel-btn"
              class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
            >
              <i class="fas fa-folder-plus mr-2"></i>Create Folder
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal">
      <div class="modal-content">
        <span class="close-button" id="upload-modal-close">&times;</span>
        <h3 class="text-xl font-bold mb-4">Upload Images</h3>
        <div class="mb-4">
          <p class="text-sm text-gray-600">
            Upload to:
            <strong id="upload-path-display" class="text-indigo-600"></strong>
          </p>
        </div>
        <form id="upload-form">
          <input type="hidden" id="upload-folder-path" name="folderPath" />
          <div class="form-group mb-4">
            <label
              for="file-input"
              class="block text-sm font-medium text-gray-700 mb-2"
            >
              Select Images (multiple allowed):
            </label>
            <input
              type="file"
              id="file-input"
              name="files"
              multiple
              required
              accept="image/*"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
            <p class="text-sm text-gray-500 mt-1">
              You can select multiple images at once. Supported formats: JPG,
              PNG, GIF, WebP
            </p>
          </div>
          <div class="flex justify-end space-x-3">
            <button
              type="button"
              id="upload-cancel-btn"
              class="px-4 py-2 text-gray-600 bg-gray-200 rounded-md hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              type="submit"
              id="upload-button"
              class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
              <i class="fas fa-upload mr-2"></i>Upload Images
            </button>
          </div>
        </form>
        <div id="upload-status" class="status-message mt-4"></div>
      </div>
    </div>

    <script src="/public/js/frontend-logger.js"></script>
    <script src="/public/js/sidebar.js"></script>
    <script src="/public/js/dashboard.js"></script>
    <script src="/public/js/azure-image-browser.js"></script>
  </body>
</html>
