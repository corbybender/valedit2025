<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Page Templates<% if (typeof currentWorkingSite !== 'undefined' &&
      currentWorkingSite && currentWorkingSite.WebsiteName) { %> - <%=
      currentWorkingSite.WebsiteName %><% } %>
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="/public/css/dashboard.css" rel="stylesheet" />
    <link href="/public/css/pagetemplates.css" rel="stylesheet" />
    <script src="/public/js/notifications.js"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material-darker.min.css"
    />

    <script>
      const currentWorkingSite = <%- JSON.stringify(typeof currentWorkingSite !== 'undefined' ? currentWorkingSite : null) %>;
    </script>
  </head>
  <body>
    <div class="dashboard-container">
      <%- include('../partials/sidebar') %>

      <div class="main-content">
        <%- include('../partials/header') %>

        <main
          class="content bg-white p-8 rounded-lg shadow-lg w-full max-w-12xl flex flex-col overflow-hidden"
          style="height: calc(100vh - 150px)"
        >
          <% if (typeof currentWorkingSite === 'undefined' ||
          !currentWorkingSite || !currentWorkingSite.CurrentWorkingSite) { %>
          <div style="text-align: center; padding: 50px">
            <h2 style="color: #666; margin-bottom: 20px">
              No Website Selected
            </h2>
            <p style="margin-bottom: 30px">
              You need to select a website before you can manage page templates.
            </p>
            <a
              href="/websites"
              style="
                background: #007bff;
                color: white;
                padding: 12px 24px;
                text-decoration: none;
                border-radius: 6px;
              "
            >
              Select a Website
            </a>
          </div>
          <% } else { %>

          <div
            id="notification-container"
            class="fixed top-4 right-4 z-50 space-y-2"
          ></div>

          <div class="flex justify-between items-center mb-6 flex-shrink-0">
            <div class="flex space-x-4 items-center">
              <div class="relative">
                <select
                  id="category-filter"
                  class="px-4 py-2 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 min-w-48"
                >
                  <option value="">All Categories</option>
                </select>
              </div>
            </div>
            <div id="template-deets" class="hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:-ml-[140px]">
                <div>
                  <label
                    for="template-name"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Template Name *
                  </label>
                  <input
                    type="text"
                    id="template-name"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Enter template name"
                  />
                </div>

                <div>
                  <label
                    for="template-category"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Category *
                  </label>
                  <select
                    id="template-category"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="">-- Select a Category --</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="flex space-x-2">
              <button
                id="manage-categories-btn"
                class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
              >
                <i class="fas fa-tags mr-2"></i>Manage Categories
              </button>
              <button
                id="add-new-btn"
                class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
              >
                <i class="fas fa-plus mr-2"></i>Add New Template
              </button>
            </div>
          </div>

          <div
            class="grid grid-cols-[280px_1fr] gap-6 flex-grow overflow-hidden"
            style="min-height: 0"
          >
            <div class="flex flex-col h-full overflow-y-auto">
              <div
                class="bg-gray-50 rounded-lg p-4 flex flex-col flex-grow overflow-hidden"
              >
                <div
                  id="template-list-container"
                  class="space-y-2 overflow-y-auto flex-grow"
                >
                  <!-- Templates will be loaded here -->
                  <!-- Templates will be loaded here -->
                  <!-- Templates will be loaded here -->
                </div>
              </div>
            </div>

            <div class="flex flex-col overflow-hidden" style="height: 100%">
              <div
                id="placeholder-view"
                class="text-center p-12 flex-grow flex flex-col justify-center items-center"
              >
                <i class="fas fa-file-code text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-medium text-gray-600 mb-2">
                  Select a Template
                </h3>
                <p class="text-gray-500">
                  Choose a template from the list to edit, or create a new one.
                </p>
              </div>

              <div
                id="editor-container"
                class="hidden flex-grow flex flex-col overflow-hidden"
              >
                <form
                  id="template-form"
                  class="space-y-6 flex-grow flex flex-col overflow-y-auto max-w-full"
                >
                  <input type="hidden" id="template-id" />

                  <div class="bg-white border rounded-lg p-6 flex-shrink-0">
                    <div class="mt-4">
                      <label
                        for="template-description"
                        class="block text-sm font-medium text-gray-700 mb-2"
                      >
                        Description
                      </label>
                      <textarea
                        id="template-description"
                        rows="3"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter template description"
                      ></textarea>
                    </div>
                  </div>

                  <div
                    class="bg-white border rounded-lg p-6 flex-grow overflow-y-auto"
                  >
                    <div class="flex justify-between items-center mb-4">
                      <h3 class="text-lg font-semibold">Code View</h3>
                      <button
                        type="button"
                        id="fullscreen-toggle"
                        class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm"
                        title="Toggle Fullscreen"
                      >
                        <i class="fas fa-expand" id="fullscreen-icon"></i>
                        <span id="fullscreen-text" class="ml-1">Fullscreen</span>
                      </button>
                    </div>
                    <div
                      class="editor-container border rounded-md flex-grow"
                      style="min-height: 1500px"
                    >
                      <textarea
                        id="template-html"
                        class="w-full h-full"
                      ></textarea>
                    </div>
                  </div>

                  <div class="flex justify-between flex-shrink-0">
                    <button
                      type="button"
                      id="delete-btn"
                      class="px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 hidden"
                    >
                      <i class="fas fa-trash mr-2"></i>Delete Template
                    </button>
                    <div class="flex space-x-3">
                      <button
                        type="submit"
                        class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                      >
                        <i class="fas fa-save mr-2"></i>Save Template
                      </button>
                      <button
                        type="button"
                        id="cancel-btn"
                        class="px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"
                      >
                        <i class="fas fa-times mr-2"></i>Cancel
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div id="category-modal" class="modal-overlay hidden">
            <div class="modal-container">
              <div class="modal-header">
                <h3 class="text-lg font-semibold">Manage Categories</h3>
                <button
                  id="close-modal-btn"
                  class="text-gray-400 hover:text-gray-600"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="modal-body">
                <div class="mb-6">
                  <label
                    for="new-category-name"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Add New Category
                  </label>
                  <div class="flex space-x-2">
                    <input
                      type="text"
                      id="new-category-name"
                      class="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Category name"
                    />
                    <button
                      id="add-category-btn"
                      class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                    >
                      Add
                    </button>
                  </div>
                </div>

                <div>
                  <h4 class="text-sm font-medium text-gray-700 mb-3">
                    Existing Categories
                  </h4>
                  <div id="category-list" class="space-y-2"></div>
                </div>
              </div>
            </div>
          </div>

          <% } %>
        </main>
      </div>
    </div>

    <script src="/public/js/frontend-logger.js"></script>
    <script src="/public/js/sidebar.js"></script>
    <script src="/public/js/dashboard.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>

    <script src="/public/js/pagetemplates.js"></script>
  </body>
</html>
